<DOCTYPE! HTML>
<html>
    <head>
        <title>UX ⚡ Scott Krause | Vue.js TypeScript Go WASM</title>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=2, minimum-scale=1, width=device-width, height=device-height">
    </head>
    <body>
    <ol>
       <li> ✅ The resulting CSV files will contain a header row with deterministic column names</li>
       <li> ✅ The resulting CSV files will be quoted</li>
       <li> ✅ The file name is auto-generated with timestamp</li>
       <li> ✅ Cell string data may contain a comma “,” however quotes will be removed</li>
       <li> ✅ Cell string data may contain only utf-8 characters</li>
    </ol>
        <script>
            //  console.log( JSON.stringify( document.querySelector("DIV#app").__vue__.$store.state.cyberGraph.elements ));
            const jCurrentGraph = {"edges":[{"data":{"id":"-Ujd61GFxAtdkFTlyLecCbRfX-0=_ZM4H8FAZADVpsGptwFSgIRMbp_g=_MemberOf","source":"-Ujd61GFxAtdkFTlyLecCbRfX-0=","target":"ZM4H8FAZADVpsGptwFSgIRMbp_g=","label":"MemberOf"}},{"data":{"id":"u3P4_MUOcwj6vS0VZPB7dB7U9Wo=_ZM4H8FAZADVpsGptwFSgIRMbp_g=_MemberOf","source":"u3P4_MUOcwj6vS0VZPB7dB7U9Wo=","target":"ZM4H8FAZADVpsGptwFSgIRMbp_g=","label":"MemberOf"}},{"data":{"id":"i9BK0MJclcElN5XpRJBfjDxqEVU=_ZM4H8FAZADVpsGptwFSgIRMbp_g=_MemberOf","source":"i9BK0MJclcElN5XpRJBfjDxqEVU=","target":"ZM4H8FAZADVpsGptwFSgIRMbp_g=","label":"MemberOf"}},{"data":{"id":"fyNVIkaxcwczfZAsl_Ig1hjqZEA=_ZM4H8FAZADVpsGptwFSgIRMbp_g=_MemberOf","source":"fyNVIkaxcwczfZAsl_Ig1hjqZEA=","target":"ZM4H8FAZADVpsGptwFSgIRMbp_g=","label":"MemberOf"}},{"data":{"id":"uKa0AkRegazUYkBa9oHulkNkqKQ=_ZM4H8FAZADVpsGptwFSgIRMbp_g=_MemberOf","source":"uKa0AkRegazUYkBa9oHulkNkqKQ=","target":"ZM4H8FAZADVpsGptwFSgIRMbp_g=","label":"MemberOf"}},{"data":{"id":"7ZQpZafO9NXSxTXpQNqRxMbHVAM=_ZM4H8FAZADVpsGptwFSgIRMbp_g=_MemberOf","source":"7ZQpZafO9NXSxTXpQNqRxMbHVAM=","target":"ZM4H8FAZADVpsGptwFSgIRMbp_g=","label":"MemberOf"}},{"data":{"id":"yBwNLHiekfR6ZSAlPlwSQ4wDvJw=_ZM4H8FAZADVpsGptwFSgIRMbp_g=_MemberOf","source":"yBwNLHiekfR6ZSAlPlwSQ4wDvJw=","target":"ZM4H8FAZADVpsGptwFSgIRMbp_g=","label":"MemberOf"}},{"data":{"id":"fhOm1wuqPebX5ceo6VtD9GwTK7I=_ZM4H8FAZADVpsGptwFSgIRMbp_g=_Contains","source":"fhOm1wuqPebX5ceo6VtD9GwTK7I=","target":"ZM4H8FAZADVpsGptwFSgIRMbp_g=","label":"Contains"}}],"nodes":[{"id":"-Ujd61GFxAtdkFTlyLecCbRfX-0=","label":"users","data":{"id":"-Ujd61GFxAtdkFTlyLecCbRfX-0=","label":"users","data":{"id":"-Ujd61GFxAtdkFTlyLecCbRfX-0=","label":"users","t_edgeCount":11,"t_outEdgeCount":7,"name":"ADMINISTRATOR@MARVL.LOCAL","t_inEdgeCount":4,"t_perEdgeCount":[{"count":6,"otherVertexLabel":"groups","edgeLabel":"MemberOf","edgeDirection":"OUT"},{"count":3,"otherVertexLabel":"groups","edgeLabel":"ACL","edgeDirection":"IN"},{"count":1,"otherVertexLabel":"domains","edgeLabel":"Contains","edgeDirection":"IN"},{"count":1,"otherVertexLabel":"computers","edgeLabel":"AdminTo","edgeDirection":"OUT"}]}}},{"id":"u3P4_MUOcwj6vS0VZPB7dB7U9Wo=","label":"users","data":{"id":"u3P4_MUOcwj6vS0VZPB7dB7U9Wo=","label":"users","data":{"id":"u3P4_MUOcwj6vS0VZPB7dB7U9Wo=","label":"users","t_edgeCount":7,"t_outEdgeCount":3,"name":"ARTEM@MARVL.LOCAL","t_inEdgeCount":4,"t_perEdgeCount":[{"count":3,"otherVertexLabel":"groups","edgeLabel":"MemberOf","edgeDirection":"OUT"},{"count":3,"otherVertexLabel":"groups","edgeLabel":"ACL","edgeDirection":"IN"},{"count":1,"otherVertexLabel":"domains","edgeLabel":"Contains","edgeDirection":"IN"}]}}},{"id":"i9BK0MJclcElN5XpRJBfjDxqEVU=","label":"users","data":{"id":"i9BK0MJclcElN5XpRJBfjDxqEVU=","label":"users","data":{"id":"i9BK0MJclcElN5XpRJBfjDxqEVU=","label":"users","t_edgeCount":6,"t_outEdgeCount":2,"name":"ATTACKER@MARVL.LOCAL","t_inEdgeCount":4,"t_perEdgeCount":[{"count":2,"otherVertexLabel":"groups","edgeLabel":"MemberOf","edgeDirection":"OUT"},{"count":3,"otherVertexLabel":"groups","edgeLabel":"ACL","edgeDirection":"IN"},{"count":1,"otherVertexLabel":"domains","edgeLabel":"Contains","edgeDirection":"IN"}]}}},{"id":"fyNVIkaxcwczfZAsl_Ig1hjqZEA=","label":"users","data":{"id":"fyNVIkaxcwczfZAsl_Ig1hjqZEA=","label":"users","data":{"id":"fyNVIkaxcwczfZAsl_Ig1hjqZEA=","label":"users","t_edgeCount":6,"t_outEdgeCount":2,"name":"ASDFASDFASDFWWEFWEFW@MARVL.LOCAL","t_inEdgeCount":4,"t_perEdgeCount":[{"count":2,"otherVertexLabel":"groups","edgeLabel":"MemberOf","edgeDirection":"OUT"},{"count":3,"otherVertexLabel":"groups","edgeLabel":"ACL","edgeDirection":"IN"},{"count":1,"otherVertexLabel":"domains","edgeLabel":"Contains","edgeDirection":"IN"}]}}},{"id":"uKa0AkRegazUYkBa9oHulkNkqKQ=","label":"users","data":{"id":"uKa0AkRegazUYkBa9oHulkNkqKQ=","label":"users","data":{"id":"uKa0AkRegazUYkBa9oHulkNkqKQ=","label":"users","t_edgeCount":7,"t_outEdgeCount":3,"name":"DANIELLE-DA@MARVL.LOCAL","t_inEdgeCount":4,"t_perEdgeCount":[{"count":3,"otherVertexLabel":"groups","edgeLabel":"MemberOf","edgeDirection":"OUT"},{"count":3,"otherVertexLabel":"groups","edgeLabel":"ACL","edgeDirection":"IN"},{"count":1,"otherVertexLabel":"domains","edgeLabel":"Contains","edgeDirection":"IN"}]}}},{"id":"7ZQpZafO9NXSxTXpQNqRxMbHVAM=","label":"users","data":{"id":"7ZQpZafO9NXSxTXpQNqRxMbHVAM=","label":"users","data":{"id":"7ZQpZafO9NXSxTXpQNqRxMbHVAM=","label":"users","t_edgeCount":7,"t_outEdgeCount":3,"name":"AAA@MARVL.LOCAL","t_inEdgeCount":4,"t_perEdgeCount":[{"count":3,"otherVertexLabel":"groups","edgeLabel":"MemberOf","edgeDirection":"OUT"},{"count":3,"otherVertexLabel":"groups","edgeLabel":"ACL","edgeDirection":"IN"},{"count":1,"otherVertexLabel":"domains","edgeLabel":"Contains","edgeDirection":"IN"}]}}},{"id":"yBwNLHiekfR6ZSAlPlwSQ4wDvJw=","label":"users","data":{"id":"yBwNLHiekfR6ZSAlPlwSQ4wDvJw=","label":"users","data":{"id":"yBwNLHiekfR6ZSAlPlwSQ4wDvJw=","label":"users","t_edgeCount":8,"t_outEdgeCount":4,"name":"MIKE@MARVL.LOCAL","t_inEdgeCount":4,"t_perEdgeCount":[{"count":3,"otherVertexLabel":"groups","edgeLabel":"ACL","edgeDirection":"IN"},{"count":4,"otherVertexLabel":"groups","edgeLabel":"MemberOf","edgeDirection":"OUT"},{"count":1,"otherVertexLabel":"domains","edgeLabel":"Contains","edgeDirection":"IN"}]}}},{"id":"fhOm1wuqPebX5ceo6VtD9GwTK7I=","label":"domains","data":{"id":"fhOm1wuqPebX5ceo6VtD9GwTK7I=","label":"domains","data":{"id":"fhOm1wuqPebX5ceo6VtD9GwTK7I=","label":"domains","t_edgeCount":1556,"t_outEdgeCount":1557,"name":"MARVL.LOCAL","t_inEdgeCount":5,"t_perEdgeCount":[{"count":1500,"otherVertexLabel":"users","edgeLabel":"Contains","edgeDirection":"OUT"},{"count":3,"otherVertexLabel":"gpos","edgeLabel":"Contains","edgeDirection":"OUT"},{"count":49,"otherVertexLabel":"groups","edgeLabel":"Contains","edgeDirection":"OUT"},{"count":5,"otherVertexLabel":"groups","edgeLabel":"ACL","edgeDirection":"IN"},{"count":1,"otherVertexLabel":"ous","edgeLabel":"Contains","edgeDirection":"OUT"}]}}},{"id":"ZM4H8FAZADVpsGptwFSgIRMbp_g=","label":"groups","data":{"id":"ZM4H8FAZADVpsGptwFSgIRMbp_g=","label":"groups","data":{"id":"ZM4H8FAZADVpsGptwFSgIRMbp_g=","label":"groups","t_edgeCount":1567,"t_outEdgeCount":1557,"name":"DOMAIN ADMINS@MARVL.LOCAL","t_inEdgeCount":11,"t_perEdgeCount":[{"count":3,"otherVertexLabel":"gpos","edgeLabel":"ACL","edgeDirection":"OUT"},{"count":48,"otherVertexLabel":"groups","edgeLabel":"ACL","edgeDirection":"OUT"},{"count":2,"otherVertexLabel":"groups","edgeLabel":"MemberOf","edgeDirection":"OUT"},{"count":3,"otherVertexLabel":"groups","edgeLabel":"ACL","edgeDirection":"IN"},{"count":1,"otherVertexLabel":"domains","edgeLabel":"Contains","edgeDirection":"IN"},{"count":7,"otherVertexLabel":"users","edgeLabel":"MemberOf","edgeDirection":"IN"},{"count":4,"otherVertexLabel":"computers","edgeLabel":"AdminTo","edgeDirection":"OUT"},{"count":1,"otherVertexLabel":"domains","edgeLabel":"ACL","edgeDirection":"OUT"},{"count":1499,"otherVertexLabel":"users","edgeLabel":"ACL","edgeDirection":"OUT"}]}}}]};

let currentGraph2Array = ( _jnCSV ) => {  //  Format the CS graph data store
    let jnCSV = _jnCSV.nodes.map( (el) => {
        el = Object.entries( el )[2][1];
        el = Object.entries( el )[2][1];
        el = Object.entries( el ).flat();
        return el;
    });
    return jnCSV;
}

let nativeCSV = ( ( _d )=>{  //  Produce CSV with client-side JS
    let oCnt, jnCSV, sCSV, blCSV, elCSV;  //  config, json, array, blob, and element
    let retObj = {
        "init": ( _oCnt )=>{
            oCnt = _oCnt;
            if( oCnt.fileName.indexOf("####") !== -1) {
                oCnt.fileName = oCnt.fileName.replace("####", Date.now() );}
            jnCSV = sCSV = blCSV = elCSV = "";
            return retObj;
        },
        "setArray": ( _jnCSV )=>{  //  An array (rows) of arrays (cols) !jagged
            jnCSV = _jnCSV;
            if( oCnt.header ) jnCSV.unshift( oCnt.header );
            jnCSV.forEach(( aRow )=>{
                aRow.forEach(( sCol )=>{
                    if( typeof sCol === "string"){
                        sCSV += oCnt.delimQuote + sCol
                            .split( oCnt.delimQuote ).join("");
                        sCSV += oCnt.delimQuote + oCnt.delimCol;                       
                    }
                });
                sCSV = sCSV.slice(0, -1) + oCnt.delimLine;
            });
            return retObj;
        },
        "getBlob": ()=>{
            blCSV = new Blob([ sCSV ], { type: "text/csv;charset=utf-8;" });
            return retObj;
        },
        "createLink": ()=>{
            elCSV = _d.createElement("a");
            elCSV.setAttribute("href", URL.createObjectURL( blCSV ));
            elCSV.setAttribute("download", oCnt.fileName );
            elCSV.style.visibility = 'hidden';
            _d.body.appendChild( elCSV );
            return retObj;
        },
        "clickLink": ()=>{
            elCSV.click();
            return retObj;
        },
        "removeLink": ()=>{
            _d.body.removeChild( elCSV );
            return retObj;
        }
    };
    return retObj;
})( document );

console.log( nativeCSV.init({
"delimCol": ",",
"delimQuote": '"',
"delimLine": "\n",
"fileName": "graph_nodes_####.csv",
"header": ["id","name", "FQDN"]})
.setArray( currentGraph2Array(jCurrentGraph) )
.getBlob()
.createLink()
.clickLink()
.removeLink()    
);

        </script>
    </body>
</html>
